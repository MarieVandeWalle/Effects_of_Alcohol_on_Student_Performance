##### PERFORM THE ANALYSES #####

############################
### Descriptive analysis ###
############################
# Load necessary packages
library(ggplot2)
library(dplyr)


# Hypothesis 1: Frequency of Going Out and Academic Performance
# 1. Descriptive statistics
summary(data$Party_Frequency)
summary(data$Matric_GPA)

# 2. Mean GPA by party frequency
party_gpa_summary <- data %>%
  group_by(Party_Frequency) %>%
  summarise(mean_GPA = mean(Matric_GPA, na.rm = TRUE), median_GPA = median(Matric_GPA, na.rm = TRUE))

print(party_gpa_summary)

# Hypothesis 2: Romantic Relationship and Alcohol Consumption
# 1. Percentage of students in a romantic relationship
relationship_table <- table(data$In_Romantic_Relationship)
print(relationship_table)

# 2. Distribution of alcohol consumption by relationship status
drinks_relationship_table <- table(data$Drinks_Per_Night, data$In_Romantic_Relationship)
print(drinks_relationship_table)

# Calculate column totals
col_totals <- colSums(drinks_relationship_table)

# Convert frequencies to percentages
drinks_relationship_percent <- sweep(drinks_relationship_table, 2, col_totals, FUN = "/") * 100
print(drinks_relationship_percent)

# Hypothesis 3: Alcohol Consumption and Failed Modules
# Create a summary table of the number of people per number of failed modules
failed_modules_summary <- data %>%
  group_by(Modules_Failed) %>%
  summarise(count = n()) %>%
  mutate(percentage = (count / nrow(data)) * 100)

print(failed_modules_summary)

# Distribution of failed modules by alcohol consumption level
fails_distribution_table <- table(data$Drinks_Per_Night, data$Modules_Failed)
print(fails_distribution_table)

# Hypothesis 4: Parental Approval and Alcohol Consumption
# Percentage of students with parental approval of alcohol consumption
approval_table <- table(data$Parents_Approve_Alcohol)
print(approval_table)

# Distribution of alcohol consumption by approval status
drinks_approval_table <- table(data$Drinks_Per_Night, data$Parents_Approve_Alcohol)
print(drinks_approval_table)

# Calculate column totals
col_totals <- colSums(drinks_approval_table)

# Convert frequencies to percentages
drinks_approval_percent <- sweep(drinks_approval_table, 2, col_totals, FUN = "/") * 100
print(drinks_approval_percent)

# Hypothesis 5: Parental Relationship and Alcohol Consumption
# Create the contingency table
drinks_parental_table <- table(data$Drinks_Per_Night, data$Parental_Relationship)
print(drinks_parental_table)

# Calculate column totals
col_totals <- colSums(drinks_parental_table)

# Convert frequencies to percentages
drinks_parental_percent <- sweep(drinks_parental_table, 2, col_totals, FUN = "/") * 100
print(drinks_parental_percent)

#### Interpretation of significant relationship of Hypothesis 5 
# Load the necessary packages
library(dplyr)
library(ggplot2)

# Filter out rows with NA in Parental_Relationship
data <- data %>% filter(!is.na(Parental_Relationship))

# Create the proportional bar chart
ggplot(data, aes(x = Parental_Relationship, fill = Drinks_Per_Night)) +
  geom_bar(position = "fill") +
  xlab("Parental Relationship Quality") +
  ylab("Proportion") +
  ggtitle("Proportion of Alcohol Consumption by Parental Relationship Quality") +
  labs(fill = "Drinks Per Night") +
  scale_fill_discrete(labels = c("0", "1-3", "3-5", "5-8", "8+")) +
  scale_x_discrete(labels = c("Very Close", "Close", "Fair", "Distant"))

# Calculate the distribution of alcohol consumption by parental relationship
drinks_parental_table <- table(data$Drinks_Per_Night, data$Parental_Relationship)

# Calculate the percentages
col_totals <- colSums(drinks_parental_table)
drinks_parental_percent <- sweep(drinks_parental_table, 2, col_totals, FUN = "/") * 100

# Print the frequency table and percentage table
print(drinks_parental_table)
print(drinks_parental_percent)

# Calculate the average alcohol consumption by parental relationship
mean_drinks_parental <- data %>%
  group_by(Parental_Relationship) %>%
  summarise(mean_drinks = mean(as.numeric(as.character(Drinks_Per_Night)), na.rm = TRUE))

print(mean_drinks_parental)

# Hypothesis 6: Role of Sex in Alcohol Consumption and Academic Performance
# 1. Distribution of sex within the sample
sex_distribution <- table(data$Sex)
print(sex_distribution)

# 2. Distribution of alcohol consumption by sex
drinks_sex_table <- table(data$Drinks_Per_Night, data$Sex)
print(drinks_sex_table)

# Calculate column totals
col_totals <- colSums(drinks_sex_table)

# Convert frequencies to percentages
drinks_sex_percent <- sweep(drinks_sex_table, 2, col_totals, FUN = "/") * 100
print(drinks_sex_percent)

# 3. Mean GPA by sex
gpa_sex <- data %>%
  group_by(Sex) %>%
  summarise(mean_GPA = mean(Matric_GPA, na.rm = TRUE), median_GPA = median(Matric_GPA, na.rm = TRUE))

print(gpa_sex)

############################
### Statistical analysis ###
############################

### QUESTION 1: 

### QUESTION 2: 

### QUESTION 3: Amandine: The impact of alcohol consumption (Drinks_Per_Night) on failed modules (Failed_Modules)
# Chi square test
# Create contingency tables
table_failed <- table(data$Drinks_Per_Night, data$Modules_Failed)


# Perform Chi-Square Test for failed modules
chi_square_failed <- chisq.test(table_failed) # This gives a warning message
print(chi_square_failed) # p=0.079

# Chi square test with Monte Carlo-simulation to solve the warning message
chi_square_failed_sim <- chisq.test(table_failed, simulate.p.value = TRUE, B = 2000)

# Watch results
print(table_failed)
print(chi_square_failed_sim)

### QUESTION 4: Amandine: The impact of parental relationship (Parental_Relationship) on alcohol consumption (Drinks_Per Night)
# Chi square test
# Create contingency tables
table_drinks_parental <- table(data$Drinks_Per_Night, data$Parental_Relationship)

# Frequency table
print(table_drinks_parental)

# Perform Chi-Square Test
chi_square_test <- chisq.test(table_drinks_parental)

# Watch results
print(chi_square_test) #0.028

# Chi square test with Monte Carlo-simulation to solve the warning message
chi_square_test_sim <- chisq.test(table_drinks_parental, simulate.p.value = TRUE, B = 2000)

# Watch results
print(chi_square_test_sim)

### QUESTION 5: The impact of going out (Party_Frequency) on academic performance (Matric_GPA)

### QUESTION 6: The impact of alcohol consumption (Drinks_Per_Night) on academic performance (Matric_GPA)


